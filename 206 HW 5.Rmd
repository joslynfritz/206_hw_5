---
title: "206 HW 5"
author: "Joslyn Fritz"
date: "11/28/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages and files, echo = FALSE, include = FALSE}

library(tidyverse)
library(stargazer)

faculty_salary <- read_csv("Faculty salary data.csv")

med_salary <- read_csv("Median salary for doctorals.csv")

grad_enroll <- read_csv("Grad enrollment.csv")

phd_fields <- read_csv("PhDs by Field.csv")

```


#### 1. Compare trends in graduate enrollment (1967-2015)

```{r, echo = FALSE, include = FALSE}

# Exploratory graph

male_scatter <- ggplot(grad_enroll, aes(x = year, y = male_total)) +
  geom_point()
male_scatter

# Overall the data looks linear. There are some outliers that fall outside of linear, but I think a linear regression is ok

female_scatter <- ggplot(grad_enroll, aes (x = year, y = female_total)) +
  geom_point()
female_scatter

# Overall the data looks linear. There are some outliers that fall outside of linear, but I think a linear regression is ok

```

```{r, echo = FALSE}

# Perform linear regression

male_model <- lm(male_total ~ year, data = grad_enroll)
male_model
summary(male_model)

# Total male enrollment = 9060*(year) - 17112153 

female_model <- lm(female_total ~ year, data = grad_enroll)
female_model
summary(female_model)

# Total female enrollment = 30126*(year) - 58955502
  
```

```{r, echo = FALSE, include = FALSE}

# Model diagnostics 

plot(male_model)
plot(female_model)

```

```{r, echo = FALSE}

# Pearson's R

# H0: Correlation equals 0
# HA: Correlation does not equal 0

male_r <- cor.test(grad_enroll$male_total, grad_enroll$year)
male_r

female_r <- cor.test(grad_enroll$female_total, grad_enroll$year)
female_r

```

Male: t(47) = 16.61, p < 0.001. Reject the null. Correlation = 0.92, which is a strong positive correlation.

Year significantly predicts male graduate school enrollment (*b* = -17112153, t(`r male_r$parameter`) = `r round(male_r$statistic, 2)`, *p* < 0.001) with a strong positive correlation between the two (Pearson's *r* = `r round(male_r$estimate, 2)`). The overall model (Total gradute male enrollment = 9060(year) - 17112153) explains a significant amount of variance in male enrollment (F(1,47) = 276, *p* < 0.001, R^2^ = 0.85).

Female: t(47) = 51.66, p < 0.001. Reject the null. Correlation = 0.99, which is a strong positive correlation.

Year significantly predicts female graduate school enrollment (*b* = -17112153, t(`r male_r$parameter`) = `r round(male_r$statistic, 2)`, *p* < 0.001) with a strong positive correlation between the two (Pearson's *r* = `r round(male_r$estimate, 2)`). The overall model (Total gradute female enrollment = 30126(year) - 58955502) explains a significant amount of variance in male enrollment (F(1,47) = 2669, *p* < 0.001, R^2^ = 0.98).

```{r, echo = FALSE}

# Graph it

total_grad_mvf <- ggplot(grad_enroll, aes(x = year)) + 
  geom_line(aes(y = male_total, color = "male_total")) +
  geom_line(aes(y = female_total, color = "female_total")) +
  xlab("Year") +
  ylab("Total Enrollment") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"), 
        text = element_text(family = "serif"))+
  theme(legend.text=element_text(size = 15)) +
  theme(legend.title=element_blank()) 
  
total_grad_mvf

# Find a way to rename legend

```


#### 2. Shifts in Phd recipients by field of study (1985, 2000, 2015)

```{r, echo = FALSE}

phd_female <- phd_fields %>% 
  spread(year, number)%>%  # Spread out the year designations by number
  select(-gender, -field) # removed gender and field columns
phd_female

rownames(phd_female) <- c("education", "engineering", "humanities_art", "physical_earth") # Change row names in df such that only numbers exist in the center


# Let's look at the actual proportions:

female_prop <- prop.table(as.matrix(phd_female), 1) # Updates phd_female to a matrix for it to work in prop.table. The 1 is the margin over which to calculate proportion
female_prop


# Run a chi-squared test for independence

#H0: No significant difference between proportions in year

phd_female_chi2 <- chisq.test(phd_female)
phd_female_chi2

```


number of female phd recipients per field differed significantly between 1985 (n = ) and 2000 (n = ) and 2015 (n =) ($\chi^2${`r phd_female_chi2$parameter`} = ....., p < 0.001). Notably, ....

```{r, results = 'asis'}

# Make a table of proportions

prop_table <- stargazer(female_prop, type = "html")
prop_table

```


#### 3. Male and female salaries for starting postdoc and other positions (2015)

```{r, echo = FALSE, include = FALSE}

# Exploratory graph

postdoc_med_salary <- med_salary %>%
  filter(status == "postdoc")

postdoc_hist <- ggplot(postdoc_med_salary, aes(x = male))+
  geom_histogram(bins = 6)
postdoc_hist

emp_med_salary <- med_salary %>% 
  filter(status == "employment")

emp_hist <- ggplot(emp_med_salary, aes(x = male)) +
  geom_histogram(bins = 6)
emp_hist

```

```{r, echo = FALSE}

# Wilcoxon-Signed Ranked (non-parametric, paired)

# Ho: There is NOT a significant differnece in median salary for male and female starting postdoc positions.
# HA: There is a significant difference in mdeian salary for male and female starting postdoc positions.

wsr_postdoc <- wilcox.test(postdoc_med_salary$male, postdoc_med_salary$female, paired = TRUE)
wsr_postdoc


# Ho: There is NOT a significant differnece in median salary for male and female starting non-postdoc positions.
# HA: There is a significant difference in mdeian salary for male and female starting non-postdoc positions.

wsr_emp <- wilcox.test(emp_med_salary$male, emp_med_salary$female, paired = TRUE)
wsr_emp

```
There was no significant difference in median salary for male and female starting postdoc positions (W = 180, p = 0.867, alpha = 0.05)

There was no significant difference in median salary for male and female starting postdoc positions (W = 88.5, p = 0.329, alpha = 0.05)

#### 4. Exploring academic salaries for professors in U.S. colleges

```{r}



```

